##############################################################################
## This file is part of 'ATLAS CHESS2 DEV'.
## It is subject to the license terms in the LICENSE.txt file found in the 
## top-level directory of this distribution and at: 
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html. 
## No part of 'ATLAS CHESS2 DEV', including this file, 
## may be copied, modified, propagated, or distributed except according to 
## the terms contained in the LICENSE.txt file.
##############################################################################
# CHESS2 ASIC Serial Port Mapping
set_property PACKAGE_PIN K25 [get_ports {chessDinP[0][0]} ]
set_property PACKAGE_PIN K26 [get_ports {chessDinN[0][0]} ]
set_property PACKAGE_PIN R26 [get_ports {chessDinP[0][1]} ]
set_property PACKAGE_PIN P26 [get_ports {chessDinN[0][1]} ]
set_property PACKAGE_PIN M25 [get_ports {chessDinP[0][2]} ]
set_property PACKAGE_PIN L25 [get_ports {chessDinN[0][2]} ]
set_property PACKAGE_PIN P24 [get_ports {chessDinP[0][3]} ]
set_property PACKAGE_PIN N24 [get_ports {chessDinN[0][3]} ]
set_property PACKAGE_PIN N26 [get_ports {chessDinP[0][4]} ]
set_property PACKAGE_PIN M26 [get_ports {chessDinN[0][4]} ]
set_property PACKAGE_PIN R25 [get_ports {chessDinP[0][5]} ]
set_property PACKAGE_PIN P25 [get_ports {chessDinN[0][5]} ]
set_property PACKAGE_PIN N19 [get_ports {chessDinP[0][6]} ]
set_property PACKAGE_PIN M20 [get_ports {chessDinN[0][6]} ]
set_property PACKAGE_PIN U19 [get_ports {chessDinP[0][7]} ]
set_property PACKAGE_PIN U20 [get_ports {chessDinN[0][7]} ]
set_property PACKAGE_PIN T18 [get_ports {chessDinP[0][8]} ]
set_property PACKAGE_PIN T19 [get_ports {chessDinN[0][8]} ]
set_property PACKAGE_PIN P16 [get_ports {chessDinP[0][9]} ]
set_property PACKAGE_PIN N17 [get_ports {chessDinN[0][9]} ]
set_property PACKAGE_PIN R16 [get_ports {chessDinP[0][10]} ]
set_property PACKAGE_PIN R17 [get_ports {chessDinN[0][10]} ]
set_property PACKAGE_PIN N18 [get_ports {chessDinP[0][11]} ]
set_property PACKAGE_PIN M19 [get_ports {chessDinN[0][11]} ]
set_property PACKAGE_PIN U17 [get_ports {chessDinP[0][12]} ]
set_property PACKAGE_PIN T17 [get_ports {chessDinN[0][12]} ]
set_property PACKAGE_PIN R18 [get_ports {chessDinP[0][13]} ]
set_property PACKAGE_PIN P18 [get_ports {chessDinN[0][13]} ]

set_property PACKAGE_PIN C16 [get_ports {chessDinP[1][0]} ]
set_property PACKAGE_PIN B16 [get_ports {chessDinN[1][0]} ]
set_property PACKAGE_PIN A18 [get_ports {chessDinP[1][1]} ]
set_property PACKAGE_PIN A19 [get_ports {chessDinN[1][1]} ]
set_property PACKAGE_PIN B17 [get_ports {chessDinP[1][2]} ]
set_property PACKAGE_PIN A17 [get_ports {chessDinN[1][2]} ]
set_property PACKAGE_PIN C19 [get_ports {chessDinP[1][3]} ]
set_property PACKAGE_PIN B19 [get_ports {chessDinN[1][3]} ]
set_property PACKAGE_PIN C17 [get_ports {chessDinP[1][4]} ]
set_property PACKAGE_PIN C18 [get_ports {chessDinN[1][4]} ]
set_property PACKAGE_PIN D15 [get_ports {chessDinP[1][5]} ]
set_property PACKAGE_PIN D16 [get_ports {chessDinN[1][5]} ]
set_property PACKAGE_PIN H16 [get_ports {chessDinP[1][6]} ]
set_property PACKAGE_PIN G16 [get_ports {chessDinN[1][6]} ]
set_property PACKAGE_PIN H19 [get_ports {chessDinP[1][7]} ]
set_property PACKAGE_PIN G20 [get_ports {chessDinN[1][7]} ]
set_property PACKAGE_PIN K20 [get_ports {chessDinP[1][8]} ]
set_property PACKAGE_PIN J20 [get_ports {chessDinN[1][8]} ]
set_property PACKAGE_PIN J18 [get_ports {chessDinP[1][9]} ]
set_property PACKAGE_PIN J19 [get_ports {chessDinN[1][9]} ]
set_property PACKAGE_PIN L19 [get_ports {chessDinP[1][10]} ]
set_property PACKAGE_PIN L20 [get_ports {chessDinN[1][10]} ]
set_property PACKAGE_PIN K16 [get_ports {chessDinP[1][11]} ]
set_property PACKAGE_PIN K17 [get_ports {chessDinN[1][11]} ]
set_property PACKAGE_PIN M17 [get_ports {chessDinP[1][12]} ]
set_property PACKAGE_PIN L18 [get_ports {chessDinN[1][12]} ]
set_property PACKAGE_PIN L17 [get_ports {chessDinP[1][13]} ]
set_property PACKAGE_PIN K18 [get_ports {chessDinN[1][13]} ]

set_property PACKAGE_PIN H9  [get_ports {chessDinP[2][0]} ]
set_property PACKAGE_PIN H8  [get_ports {chessDinN[2][0]} ]
set_property PACKAGE_PIN G10 [get_ports {chessDinP[2][1]} ]
set_property PACKAGE_PIN G9  [get_ports {chessDinN[2][1]} ]
set_property PACKAGE_PIN J13 [get_ports {chessDinP[2][2]} ]
set_property PACKAGE_PIN H13 [get_ports {chessDinN[2][2]} ]
set_property PACKAGE_PIN J11 [get_ports {chessDinP[2][3]} ]
set_property PACKAGE_PIN J10 [get_ports {chessDinN[2][3]} ]
set_property PACKAGE_PIN H14 [get_ports {chessDinP[2][4]} ]
set_property PACKAGE_PIN G14 [get_ports {chessDinN[2][4]} ]
set_property PACKAGE_PIN H12 [get_ports {chessDinP[2][5]} ]
set_property PACKAGE_PIN H11 [get_ports {chessDinN[2][5]} ]
set_property PACKAGE_PIN F9  [get_ports {chessDinP[2][6]} ]
set_property PACKAGE_PIN F8  [get_ports {chessDinN[2][6]} ]
set_property PACKAGE_PIN E13 [get_ports {chessDinP[2][7]} ]
set_property PACKAGE_PIN E12 [get_ports {chessDinN[2][7]} ]
set_property PACKAGE_PIN C14 [get_ports {chessDinP[2][8]} ]
set_property PACKAGE_PIN C13 [get_ports {chessDinN[2][8]} ]
set_property PACKAGE_PIN B12 [get_ports {chessDinP[2][9]} ]
set_property PACKAGE_PIN B11 [get_ports {chessDinN[2][9]} ]
set_property PACKAGE_PIN B14 [get_ports {chessDinP[2][10]} ]
set_property PACKAGE_PIN A14 [get_ports {chessDinN[2][10]} ]
set_property PACKAGE_PIN B10 [get_ports {chessDinP[2][11]} ]
set_property PACKAGE_PIN A10 [get_ports {chessDinN[2][11]} ]
set_property PACKAGE_PIN B15 [get_ports {chessDinP[2][12]} ]
set_property PACKAGE_PIN A15 [get_ports {chessDinN[2][12]} ]
set_property PACKAGE_PIN A13 [get_ports {chessDinP[2][13]} ]
set_property PACKAGE_PIN A12 [get_ports {chessDinN[2][13]} ]

set_property IOSTANDARD LVDS_25 [get_ports {chessDinP[*} ]
set_property IOSTANDARD LVDS_25 [get_ports {chessDinN[*} ]
set_property DIFF_TERM true  [get_ports {chessDinP[*} ]
set_property DIFF_TERM true  [get_ports {chessDinN[*} ]

set_property PACKAGE_PIN N21 [get_ports {chessClk320MHzP[0]} ]
set_property PACKAGE_PIN N22 [get_ports {chessClk320MHzN[0]} ]
set_property PACKAGE_PIN F17 [get_ports {chessClk320MHzP[1]} ]
set_property PACKAGE_PIN E17 [get_ports {chessClk320MHzN[1]} ]
set_property PACKAGE_PIN E10 [get_ports {chessClk320MHzP[2]} ]
set_property PACKAGE_PIN D10 [get_ports {chessClk320MHzN[2]} ]

set_property IOSTANDARD LVDS_25 [get_ports {chessClk320MHzP[*]} ]
set_property IOSTANDARD LVDS_25 [get_ports {chessClk320MHzN[*]} ]

# CHESS2 Timing Clock Port Mapping
set_property -dict { PACKAGE_PIN F22 IOSTANDARD LVCMOS33 SLEW FAST } [get_ports { chessClk40MHz[0] }];
set_property -dict { PACKAGE_PIN E23 IOSTANDARD LVCMOS33 SLEW FAST } [get_ports { chessClk40MHz[1] }];
set_property -dict { PACKAGE_PIN G22 IOSTANDARD LVCMOS33 SLEW FAST } [get_ports { chessClk40MHz[2] }];

# Test Structure Port Mapping
set_property -dict { PACKAGE_PIN B22 IOSTANDARD LVCMOS33 } [get_ports { bitSel }];
set_property -dict { PACKAGE_PIN A22 IOSTANDARD LVCMOS33 } [get_ports { acMode }];
set_property -dict { PACKAGE_PIN B26 IOSTANDARD LVCMOS33 } [get_ports { lvdsTxSel }];
set_property -dict { PACKAGE_PIN A24 IOSTANDARD LVCMOS33 } [get_ports { term100 }];
set_property -dict { PACKAGE_PIN D26 IOSTANDARD LVCMOS33 } [get_ports { term300 }];
set_property -dict { PACKAGE_PIN C26 IOSTANDARD LVCMOS33 } [get_ports { dacEnL }];
set_property -dict { PACKAGE_PIN E21 IOSTANDARD LVCMOS33 } [get_ports { testClk }];
set_property -dict { PACKAGE_PIN T24 IOSTANDARD LVCMOS25 } [get_ports { injSig[0] }];
set_property -dict { PACKAGE_PIN T20 IOSTANDARD LVCMOS25 } [get_ports { injSig[1] }];

# SACI  Port Mapping
set_property -dict { PACKAGE_PIN H23 IOSTANDARD LVCMOS33 } [get_ports { saciClk }];
set_property -dict { PACKAGE_PIN H24 IOSTANDARD LVCMOS33 } [get_ports { saciCmd }];
set_property -dict { PACKAGE_PIN J21 IOSTANDARD LVCMOS33 } [get_ports { saciRstL }];

set_property -dict { PACKAGE_PIN H22 IOSTANDARD LVCMOS33 } [get_ports { saciSelL[0] }];
set_property -dict { PACKAGE_PIN J24 IOSTANDARD LVCMOS33 } [get_ports { saciSelL[1] }];
set_property -dict { PACKAGE_PIN J25 IOSTANDARD LVCMOS33 } [get_ports { saciSelL[2] }];
set_property -dict { PACKAGE_PIN L22 IOSTANDARD LVCMOS33 } [get_ports { saciSelL[3] }];

set_property -dict { PACKAGE_PIN K22 IOSTANDARD LVCMOS33 PULLUP true } [get_ports { saciRsp[0] }];
set_property -dict { PACKAGE_PIN K23 IOSTANDARD LVCMOS33 PULLUP true } [get_ports { saciRsp[1] }];
set_property -dict { PACKAGE_PIN J23 IOSTANDARD LVCMOS33 PULLUP true } [get_ports { saciRsp[2] }];
set_property -dict { PACKAGE_PIN L23 IOSTANDARD LVCMOS33 PULLUP true } [get_ports { saciRsp[3] }];

# DAC Port Mapping
set_property -dict { PACKAGE_PIN M24 IOSTANDARD LVCMOS25 } [get_ports { dacSlowSck[0] }];
set_property -dict { PACKAGE_PIN L24 IOSTANDARD LVCMOS25 } [get_ports { dacSlowMosi[0] }];
set_property -dict { PACKAGE_PIN P19 IOSTANDARD LVCMOS25 } [get_ports { dacSlowCsL[0] }];

set_property -dict { PACKAGE_PIN G15 IOSTANDARD LVCMOS25 } [get_ports { dacSlowSck[1] }];
set_property -dict { PACKAGE_PIN F15 IOSTANDARD LVCMOS25 } [get_ports { dacSlowMosi[1] }];
set_property -dict { PACKAGE_PIN J15 IOSTANDARD LVCMOS25 } [get_ports { dacSlowCsL[1] }];

# PGP Port Mapping
set_property PACKAGE_PIN D6 [get_ports {gtClkP}]
set_property PACKAGE_PIN D5 [get_ports {gtClkN}]

set_property PACKAGE_PIN F2 [get_ports {gtTxP}]
set_property PACKAGE_PIN F1 [get_ports {gtTxN}]
set_property PACKAGE_PIN G4 [get_ports {gtRxP}]
set_property PACKAGE_PIN G3 [get_ports {gtRxN}]

# SLAC Timing Port Mapping
set_property PACKAGE_PIN H6 [get_ports {evrClkP}]
set_property PACKAGE_PIN H5 [get_ports {evrClkN}]

set_property PACKAGE_PIN P2 [get_ports {evrTxP}]
set_property PACKAGE_PIN P1 [get_ports {evrTxN}]
set_property PACKAGE_PIN R4 [get_ports {evrRxP}]
set_property PACKAGE_PIN R3 [get_ports {evrRxN}]

# SYS Port Mapping
set_property -dict { PACKAGE_PIN F23 IOSTANDARD LVCMOS33 } [get_ports { extTrigL }];
set_property -dict { PACKAGE_PIN E25 IOSTANDARD LVCMOS33 } [get_ports { redL[0] }];
set_property -dict { PACKAGE_PIN D25 IOSTANDARD LVCMOS33 } [get_ports { blueL[0] }];
set_property -dict { PACKAGE_PIN G25 IOSTANDARD LVCMOS33 } [get_ports { greenL[0] }];
set_property -dict { PACKAGE_PIN G26 IOSTANDARD LVCMOS33 } [get_ports { redL[1] }];
set_property -dict { PACKAGE_PIN F25 IOSTANDARD LVCMOS33 } [get_ports { blueL[1] }];
set_property -dict { PACKAGE_PIN E26 IOSTANDARD LVCMOS33 } [get_ports { greenL[1] }];
set_property -dict { PACKAGE_PIN H26 IOSTANDARD LVCMOS33 } [get_ports { extBusy }];
set_property -dict { PACKAGE_PIN K21 IOSTANDARD LVCMOS33 } [get_ports { tempAlertL }];

set_property -dict { PACKAGE_PIN C11 IOSTANDARD LVCMOS25 } [get_ports { led[0] }];
set_property -dict { PACKAGE_PIN E11 IOSTANDARD LVCMOS25 } [get_ports { led[1] }];
set_property -dict { PACKAGE_PIN D11 IOSTANDARD LVCMOS25 } [get_ports { led[2] }];
set_property -dict { PACKAGE_PIN F14 IOSTANDARD LVCMOS25 } [get_ports { led[3] }];

set_property -dict { PACKAGE_PIN R21 IOSTANDARD LVCMOS25 } [get_ports { oeClk[0] }];
set_property -dict { PACKAGE_PIN P21 IOSTANDARD LVCMOS25 } [get_ports { oeClk[1] }];
set_property -dict { PACKAGE_PIN R22 IOSTANDARD LVCMOS25 } [get_ports { oeClk[2] }];

set_property -dict { PACKAGE_PIN C24 IOSTANDARD LVCMOS33 } [get_ports { pwrSyncSclk }];
set_property -dict { PACKAGE_PIN D21 IOSTANDARD LVCMOS33 } [get_ports { pwrSyncFclk }];

set_property -dict { PACKAGE_PIN C22 IOSTANDARD LVCMOS33 } [get_ports { pwrScl }];
set_property -dict { PACKAGE_PIN B20 IOSTANDARD LVCMOS33 } [get_ports { pwrSda }];

set_property -dict { PACKAGE_PIN H17 IOSTANDARD LVCMOS25 } [get_ports { configScl }];
set_property -dict { PACKAGE_PIN H18 IOSTANDARD LVCMOS25 } [get_ports { configSda }];

# Reference Clock Port Mapping
set_property -dict { PACKAGE_PIN C12 IOSTANDARD LVCMOS25 } [get_ports { locClk40MHz }];
set_property -dict { PACKAGE_PIN E18 IOSTANDARD LVDS_25 DIFF_TERM TRUE } [get_ports { extClk40MHzP }];
set_property -dict { PACKAGE_PIN D18 IOSTANDARD LVDS_25 DIFF_TERM TRUE } [get_ports { extClk40MHzN }];

# Boot Memory Port Mapping
set_property -dict { PACKAGE_PIN C23 IOSTANDARD LVCMOS33 } [get_ports { bootCsL }];
set_property -dict { PACKAGE_PIN B24 IOSTANDARD LVCMOS33 } [get_ports { bootMosi }];
set_property -dict { PACKAGE_PIN A25 IOSTANDARD LVCMOS33 } [get_ports { bootMiso }];

# XADC Port Mapping
set_property PACKAGE_PIN N12 [get_ports {vPIn}]
set_property PACKAGE_PIN P11 [get_ports {vNIn}]

# Timing Constraints
create_clock -name pgpClkRef   -period  3.200 [get_ports {gtClkP}]

create_clock -name evrClkRef -period  4.201 [get_ports {evrClkP}]
create_clock -name evrRecClk -period  8.402 [get_pins  {U_Core/U_Timing/U_EVR/U_GTX/Gtx7Core_Inst/gtxe2_i/RXOUTCLK}]

create_clock -name locClk40MHz -period 24.950 [get_ports {locClk40MHz}]
create_clock -name extClk40MHz -period 24.950 [get_ports {extClk40MHzP}]

set_property CLOCK_DEDICATED_ROUTE FALSE [get_nets {U_Core/U_Clk/locClock40MHz}]
set_property CLOCK_DEDICATED_ROUTE FALSE [get_nets {U_Core/U_Clk/extClock40MHz}]

set_case_analysis 1 [get_pins {U_Core/U_Clk/U_BUFGMUX/S}]

# StdLib
set_property ASYNC_REG TRUE [get_cells -hierarchical *crossDomainSyncReg_reg*]

# FPGA Hardware Configuration
set_property CFGBVS VCCO         [current_design]
set_property CONFIG_VOLTAGE 3.3  [current_design]

# BITSTREAM Configurations
set_property BITSTREAM.CONFIG.CONFIGRATE 50 [current_design] 
